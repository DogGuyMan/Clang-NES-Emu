# PPU 네임테이블

> 원본: https://www.nesdev.org/wiki/PPU_nametables

---

## 네임테이블이란

**네임테이블(nametable)** 은 PPU가 배경을 배치하는 데 사용하는 1024바이트 크기의 메모리 영역이다.
네임테이블의 각 바이트는 하나의 8×8 픽셀 캐릭터 셀을 제어하며, 각 네임테이블은 32개 타일 × 30행 = 960(`$3C0`)바이트로 구성된다.
나머지 64(`$40`)바이트는 각 네임테이블의 **어트리뷰트 테이블(attribute table)** 이 사용한다.

각 타일이 8×8 픽셀이므로, 하나의 맵은 총 256×240 픽셀 — 화면 하나와 정확히 같은 크기이다.

```
     (0,0)     (256,0)     (511,0)
       +-----------+-----------+
       |           |           |
       |           |           |
       |   $2000   |   $2400   |
       |           |           |
       |           |           |
(0,240)+-----------+-----------+(511,240)
       |           |           |
       |           |           |
       |   $2800   |   $2C00   |
       |           |           |
       |           |           |
       +-----------+-----------+
     (0,479)   (256,479)   (511,479)
```

> 참고: [PPU 메모리 맵](https://www.nesdev.org/wiki/PPU_memory_map)

---

## 미러링

> 주 문서: [미러링](https://www.nesdev.org/wiki/Mirroring)

NES에는 2×2 패턴으로 배열된 4개의 **논리적** 네임테이블이 있다. 각각은 PPU 주소 공간에서 1KB 청크를 차지하며, 좌상단 `$2000`부터 시작하여 우상단 `$2400`, 좌하단 `$2800`, 우하단 `$2C00`에 위치한다.

그러나 NES 시스템 보드 자체에는 2KB의 VRAM(별도의 SRAM 칩에 저장되며 **CIRAM**이라 부른다)만 있어서, 물리적 네임테이블은 2개뿐이다. 카트리지의 하드웨어가 CIRAM의 주소 비트 10을 제어하여 하나의 네임테이블을 다른 것 위에 매핑한다.

- **수평 배치(Horizontal arrangement)**: `$2000`과 `$2800` 첫 번째 네임테이블을 포함하고, `$2400`과 `$2C00` 두 번째 네임테이블을 포함한다 (예: *슈퍼 마리오 브라더스*). CIRAM A10을 PPU A10에 연결하여 구현.
- **수직 배치(Vertical arrangement)**: `$2000`과 `$2400` 첫 번째 네임테이블을 포함하고, `$2800`과 `$2C00` 두 번째 네임테이블을 포함한다 (예: *Kid Icarus*). CIRAM A10을 PPU A11에 연결하여 구현.
- **싱글 스크린(Single-screen)**: 모든 네임테이블이 주어진 시간에 동일한 메모리를 참조하며, 매퍼가 CIRAM A10을 직접 조작한다 (예: [AxROM](https://www.nesdev.org/wiki/AxROM)을 사용하는 많은 [Rare](https://www.nesdev.org/wiki/Rare) 게임들).
- **4-스크린 네임테이블(Four-screen nametables)**: 카트리지에 추가 VRAM이 포함되어 모든 네임테이블에 사용된다 (예: *Gauntlet*, *Rad Racer 2*).
- **기타**: 일부 고급 매퍼는 CIRAM, VRAM, 또는 심지어 CHR ROM의 임의 조합을 네임테이블 영역에 제시할 수 있다. 이러한 특이한 설정은 거의 사용되지 않는다.

---

## 배경 평가 (Background evaluation)

> 주 문서: [PPU 렌더링](https://www.nesdev.org/wiki/PPU_rendering)

개념적으로, PPU는 각 스캔라인에 대해 다음을 33번 수행한다:

1. `$2000–$2FFF에서` 네임테이블 엔트리를 페치한다.
2. `$23C0–$2FFF에서` 대응하는 어트리뷰트 테이블 엔트리를 페치하고, 같은 행 내에서 현재 VRAM 주소를 증가시킨다.
3. `$0000–$0FF7` 또는 `$1000–$1FF7에서` 8×1 픽셀 슬라이버(sliver)의 패턴 테이블 하위 바이트를 페치한다.
4. 8바이트 더 높은 주소에서 이 슬라이버의 상위 바이트를 페치한다.
5. 어트리뷰트 데이터와 패턴 테이블 데이터를 팔레트 인덱스로 변환하고, **우선순위(priority)**를 사용하여 **스프라이트 데이터**와 결합한다.

또한 결코 사용되지 않는 34번째 (네임테이블, 어트리뷰트, 패턴) 튜플 페치를 수행하지만, 일부 **매퍼**는 타이밍 목적으로 이 페치에 의존한다.

---

## 참고

- [PPU 어트리뷰트 테이블](https://www.nesdev.org/wiki/PPU_attribute_tables)
